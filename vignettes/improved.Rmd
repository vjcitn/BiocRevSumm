---
title: "BiocRevSumm: LLM-based summaries for Bioconductor package submissions"
shorttitle: "Bioconductor submissions"
author: "Vincent J. Carey, stvjc at channing.harvard.edu"
date: "`r format(Sys.time(), '%B %d, %Y')`"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{BiocRevSumm: LLM-based summaries for Bioconductor package submissions}
  %\VignetteEncoding{UTF-8}
output:
  BiocStyle::html_document:
    highlight: pygments
    number_sections: yes
    theme: united
    toc: yes
---

# Introduction

This package surveys issues in the Bioconductor contributions repositories
with the aim of producing a structured summary of package objectives
and capabilities.

# Enumerating packages in review

```{r geto, message=FALSE}
library(BiocRevSumm)
iss = get_repos_from_open_issues("bioconductor", "contributions")
head(iss)
```

# Finding the vignettes for high-resolution categorization

```{r getv}
rs = get_repos_from_open_issues("bioconductor", "contributions")
lk1 = strsplit(rs, "\\/")[[1]]
ghuser = lk1[4]
ghrepo = lk1[5]
lkvigs = list_github_dir(user = ghuser, repo = ghrepo, path="vignettes") 
vigs = grep("Rmd", lkvigs, value=TRUE)
# arbitrarily choose first
build_vignette_path = function(ghuser, ghrepo, branch, vname) {
  sprintf(
    "https://raw.githubusercontent.com/%s/%s/refs/heads/%s/vignettes/%s",
     ghuser, ghrepo, branch, vname
     )
   }
url = build_vignette_path(ghuser, ghrepo, branch="main", vname=vigs[1])
url
```

# Summarize a selected vignette

```{r dosumm, results="asis"}
ans = vig2data(url)
writeLines(strwrap(ans$focused, 75))
```

# Collect summaries, and categorize them

## Get paths to vignette

The first vignette found in the listing of vignettes folder with Rmd or Rnw suffix
will be selected.
```{r dofull}
issusers = sapply(strsplit(rs, "\\/"), "[", 4)
issrepos = sapply(strsplit(rs, "\\/"), "[", 5)
nrep = length(issusers)

vpaths = sapply(seq_len(nrep), function(i) {
   print(issrepos[i])
   br = find_existing_branch(issusers[i], issrepos[i], path="vignettes", branches = c("main", "master", "devel"))
print(br)
   if (is.na(br)) return(NA)
   Sys.sleep(15)  # watch out for rate limit
   vd = try(list_github_dir(user = issusers[i], repo = issrepos[i], branch=br, path="vignettes"), silent=FALSE)
   if (inherits(vd, "try-error")) return(NA)
   vn = grep("Rmd|Rnw", vd, value=TRUE)[1]
   build_vignette_path(issusers[i], issrepos[i], branch=br, vname=vn)
   })
```

## Use vig2data to summarize vignette (and thus package)

```{r lk1v, results="asis"}
z1 = vig2data(vpaths[1])
z1$focused
```
