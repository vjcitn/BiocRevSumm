---
title: "BiocRevSumm: LLM-based summaries for Bioconductor package submissions"
shorttitle: "Bioconductor submissions"
author: "Vincent J. Carey, stvjc at channing.harvard.edu"
date: "`r format(Sys.time(), '%B %d, %Y')`"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{BiocRevSumm: LLM-based summaries for Bioconductor package submissions}
  %\VignetteEncoding{UTF-8}
output:
  BiocStyle::html_document:
    highlight: pygments
    number_sections: yes
    theme: united
    toc: yes
---

# Introduction

This package surveys issues in the Bioconductor contributions repositories
with the aim of producing a structured summary of package objectives
and capabilities.

# Enumerating packages in review

```{r geto, message=FALSE}
library(BiocRevSumm)
stopifnot(nchar(Sys.getenv("GITHUB_TOKEN"))>0)
iss = get_repo_issues("bioconductor", "contributions", Sys.getenv("GITHUB_TOKEN"))
urls = get_issue_repo_urls(iss)
head(urls)
```

# Finding the vignettes for high-resolution categorization

```{r getv}
u1 = urls$repo_url[1]
lk1 = strsplit(u1, "\\/")[[1]]
ghuser = lk1[4]
ghrepo = lk1[5]
lkvigs = list_github_dir(user = ghuser, repo = ghrepo, path="vignettes") 
vigs = grep("Rmd", lkvigs, value=TRUE)
# arbitrarily choose first
build_vignette_path = function(ghuser, ghrepo, branch, vname) {
  sprintf(
    "https://raw.githubusercontent.com/%s/%s/refs/heads/%s/vignettes/%s",
     ghuser, ghrepo, branch, vname
     )
   }
url = build_vignette_path(ghuser, ghrepo, branch="main", vname=vigs[1])
url
```

# Summarize a selected vignette

```{r dosumm, results="asis"}
ans = vig2data(url)
writeLines(strwrap(ans$focused, 75))
```

# Collect summaries, and categorize them

## Get paths to vignette

The first vignette found in the listing of vignettes folder with Rmd or Rnw suffix
will be selected.
```{r dofull}
rs = urls$repo_url
issusers = sapply(strsplit(rs, "\\/"), "[", 4)
issrepos = sapply(strsplit(rs, "\\/"), "[", 5)
nrep = length(issusers)

vpaths = sapply(head(seq_len(nrep)), function(i) {
   br = find_existing_branch(issusers[i], issrepos[i], path="vignettes", branches = c("main", "master", "devel",
     "origin"))
   if (is.na(br)) return(NA)
   Sys.sleep(5)  # watch out for rate limit
   vd = try(list_github_dir(user = issusers[i], repo = issrepos[i], branch=br, path="vignettes"), silent=FALSE)
   if (inherits(vd, "try-error")) return(NA)
   vn = grep("Rmd|Rnw", vd, value=TRUE)[1]
   build_vignette_path(issusers[i], issrepos[i], branch=br, vname=vn)
   })
head(vpaths)
```

## Use vig2data to summarize vignette (and thus package)

```{r lk1v, results="asis", eval=FALSE}
z1 = vig2data(vpaths[6])
z1$focused
```

# Code that produced summaries for packages in review on 22 Nov 2025

  
```{r res, results="asis", eval=FALSE}
library(BiocRevSumm) 
data("viglist_23_nov_2025", package="BiocRevSumm")
url2heading = function(x) {
 stopifnot(length(x)==1)
 z = strsplit(x, "\\/")[[1]]
 sprintf('\n\n## Package %s from repo %s ([repo link](https://github.com/%s/%s))\n\n', z[5], z[4], z[4], z[5])
 }
for (i in seq_len(length(viglist_23_nov_2025))) {
 curvig = viglist_23_nov_2025[[i]]
 cat(url2heading(curvig), "\n")
 Sys.sleep(15)
 ans = vig2data( curvig )
 z = strsplit(curvig, "\\/")[[1]]
 fn = sprintf("%s_%s.rds", z[4], z[5])
 saveRDS(ans, file=fn)
 foc = ans$focused
 cat(foc)
}
```

